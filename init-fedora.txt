sudo dnf upgrade -y
sudo dnf install -y https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm

# sets hostname
sudo hostnamectl set-hostname NEW_HOSTNAME


# Brave browser
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager addrepo --from-repofile=https://brave-browser-rpm-release.s3.brave.com/brave-browser.repo
sudo dnf install -y brave-browser

# Spotify
sudo dnf install lpf-spotify-client
lpf approve spotify-client # requires logout
sudo -u pkg-build lpf build spotify-client # It can take up to 5 minutes
sudo dnf install /var/lib/lpf/rpms/spotify-client/spotify-client-*.rpm

# Git
sudo dnf install -y git-core

# Setup git
# git config --global user.name "Your name"
# git config --global user.email "you@example.com"
# git config --global core.editor "nvim"
# ssh-keygen -t ed22519 -C "you@example.com"
# eval "$(ssh-agent -s)"
# ssh-add ~/.ssh/id_ed25519
# Add the public key to github: cat ~/.ssh/id_ed25519.pub
# git config --global gpg.format ssh
# git config --global user.signingkey ~/.ssh/id_ed25519.pub

# Neovim
sudo dnf install -y neovim

# Node.js
# fnm (node manager):
curl -o- https://fnm.vercel.app/install | bash
fnm install --lts

fnm use 24 # current lts
fnm default 24 # current lts

# Verify the Node.js version:
node -v

# Verify npm version:
npm -v

# removes default shipped node (old version)
sudo dnf remove nodejs

# maven
sudo dnf install -y maven

# Nvidia drivers
# https://rpmfusion.org/Howto/NVIDIA?highlight=%28%5CbCategoryHowto%5Cb%29
/sbin/lspci | grep -e VGA # Determines your card model
sudo dnf update -y # and reboot if you are not on the latest kernel

sudo dnf install akmod-nvidia # rhel/centos users can use kmod-nvidia instead
sudo dnf install xorg-x11-drv-nvidia-cuda #optional for cuda/nvdec/nvenc support

sudo dracut --force
sudo reboot

nvidia-smi # verify


# Docker
sudo dnf remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-selinux \
                  docker-engine-selinux \
                  docker-engine
sudo dnf config-manager addrepo --from-repofile https://download.docker.com/linux/fedora/docker-ce.repo
sudo dnf -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo systemctl enable --now docker
sudo systemctl start docker
sudo groupadd docker
sudo usermod -aG docker $USER


# Docker desktop (preferibly not)
# sudo dnf y- install gnome-terminal
# sudo dnf y- install ./docker-desktop-x86_64.rpm

# Discord
sudo dnf -y install discord


# For terminal copy
sudo dnf -y install xclip

# Zsh
sudo dnf -y install zsh

# oh-my-zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# zsh plugins
sudo dnf install autojump
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
git clone https://github.com/zsh-users/zsh-autosuggestions.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions

# Terminal emulator
sudo dnf install -y gnome-terminal

# Nerdfont
cd ~/Downloads
wget https://github.com/ryanoasis/nerd-fonts/releases/download/v3.2.0/CodeNewRoman.zip
unzip CodeNewRoman.zip -d CodeNewRoman
mkdir -p ~/.local/share/fonts
cp ~/Downloads/CodeNewRoman/*.otf ~/.local/share/fonts/
fc-cache -fv

# To use texlab (neovim)
sudo dnf install latexmk texlive-scheme-medium

git clone git@github.com:thebaconfate/dotfiles.git ~/.dotfiles
git -C ~/.dotfiles submodule update --init # inits submodules
git -C ~/.dotfiles checkout main
git -C ~/.dotfiles pull
git -C ~/.dotfiles/nvim-config/ checkout migrate-0.11


ln -sf ~/.dotfiles/nvim-config ~/.config/nvim
ln -sf ~/.dotfiles/zsh-config/.zshrc ~/.config/nvim
ln -sf ~/.dotfiles/tmux-config/.tmux.conf ~/.tmux.conf
ln -sf ~/.dotfiles/ideavim-config/.ideavimrc ~/.ideavimrc

# Nvidia
## this is a combination of https://rpmfusion.org/Howto/Secure%20Boot
## and https://rpmfusion.org/Howto/NVIDIA#Installing_the_drivers,
## which are needed for nvidia drivers. READ the secure boot link
sudo dnf update -y
sudo reboot

sudo dnf install -y kmodtool akmods mokutil openssl akmod-nvidia xorg-x11-drv-nvidia-cuda
sudo mokutil --import /etc/pki/akmods/certs/public_key.der # give a password when prompted
sudo akmods --rebuild --force

modinfo -F version nvidia # check if built
systemctl reboot # reboot once built
nvidia-smi # check if running post reboot

# Steam
sudo dnf install -y steam

# Wine
sudo dnf install -y wine
